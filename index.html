<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Temel Meta Tags -->
    <title>YouTube Playlist Player</title>
    <meta name="description" content="YouTube playlistlerini keşfet ve müziğin tadını çıkar. Favori şarkılarını tek bir yerde dinle.">
    <meta name="keywords" content="youtube, playlist, müzik, çalma listesi, video">
    <meta name="author" content="YouTube Playlist Player">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" id="ogType">
    <meta property="og:url" content="https://your-domain.vercel.app/" id="ogUrl">
    <meta property="og:title" content="YouTube Playlist Player" id="ogTitle">
    <meta property="og:description" content="YouTube playlistlerini keşfet ve müziğin tadını çıkar. Favori şarkılarını tek bir yerde dinle." id="ogDescription">
    <meta property="og:image" content="https://your-domain.vercel.app/preview.png" id="ogImage">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="YouTube Playlist Player">
    <meta property="og:locale" content="tr_TR">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://your-domain.vercel.app/" id="twitterUrl">
    <meta name="twitter:title" content="YouTube Playlist Player" id="twitterTitle">
    <meta name="twitter:description" content="YouTube playlistlerini keşfet ve müziğin tadını çıkar. Favori şarkılarını tek bir yerde dinle." id="twitterDescription">
    <meta name="twitter:image" content="https://your-domain.vercel.app/preview.png" id="twitterImage">
    
    <!-- Discord Embed (Open Graph kullanır) -->
    <meta name="theme-color" content="#1e3a5f">
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: #121212;
            min-height: 100vh;
            padding: 20px;
            transition: background 0.8s ease;
        }

        body.loaded {
            background: linear-gradient(180deg, var(--theme-color, #1e3a5f) 0%, #121212 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding-top: 20px;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 500;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 0.95rem;
            opacity: 0.7;
            font-weight: 300;
        }

        .search-container {
            max-width: 700px;
            margin: 0 auto 40px;
        }

        .search-box {
            background: #282828;
            border-radius: 50px;
            padding: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .search-box:focus-within {
            background: #333;
            border-color: rgba(255,255,255,0.1);
            box-shadow: 0 12px 32px rgba(0,0,0,0.5);
        }

        .search-icon {
            color: #b3b3b3;
            padding: 0 16px;
            display: flex;
            align-items: center;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            padding: 16px 8px;
            font-size: 0.95rem;
            font-family: 'Roboto', sans-serif;
            background: transparent;
            color: white;
        }

        .search-box input::placeholder {
            color: #b3b3b3;
        }

        .search-box button {
            background: white;
            color: #121212;
            border: none;
            border-radius: 50px;
            padding: 12px 32px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-box button:hover {
            transform: scale(1.05);
            background: #f0f0f0;
        }

        .search-box button:active {
            transform: scale(0.98);
        }

        .player-container {
            background: #181818;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        .current-video {
            background: linear-gradient(180deg, var(--theme-color-dark, #1a2332) 0%, #181818 100%);
            padding: 40px;
            transition: background 0.8s ease;
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 16px 48px rgba(0,0,0,0.6);
            margin-bottom: 24px;
        }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .video-info {
            display: flex;
            align-items: flex-start;
            gap: 24px;
        }

        .video-thumbnail {
            width: 140px;
            height: 140px;
            border-radius: 4px;
            object-fit: cover;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
        }

        .video-details {
            flex: 1;
            padding-top: 8px;
        }

        .video-type {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #b3b3b3;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .video-title {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 12px;
            line-height: 1.3;
            letter-spacing: -0.5px;
        }

        .video-channel {
            font-size: 1rem;
            color: #b3b3b3;
            margin-bottom: 16px;
            font-weight: 400;
        }

        .video-stats {
            display: flex;
            gap: 8px;
            font-size: 0.85rem;
            color: #b3b3b3;
            align-items: center;
        }

        .video-stats span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stats-dot {
            width: 4px;
            height: 4px;
            background: #b3b3b3;
            border-radius: 50%;
        }

        .playlist-section {
            padding: 24px 40px 32px;
            background: #181818;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 8px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .playlist-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }

        .playlist-meta {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .playlist-count {
            font-size: 0.85rem;
            color: #b3b3b3;
            font-weight: 400;
        }

        .share-button {
            background: #282828;
            color: white;
            border: 1px solid #404040;
            border-radius: 20px;
            padding: 6px 16px;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .share-button:hover {
            background: #383838;
            border-color: #505050;
        }

        .share-button .material-icons {
            font-size: 16px;
        }

        .playlist-content {
            max-height: 500px;
            overflow-y: auto;
            margin: 0 -8px;
            padding: 0 8px;
        }

        .video-item {
            display: flex;
            gap: 16px;
            padding: 10px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
        }

        .video-item:hover {
            background: #282828;
        }

        .video-item.active {
            background: #282828;
        }

        .video-item-thumbnail {
            width: 80px;
            height: 45px;
            border-radius: 4px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .video-item-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .video-item-title {
            font-size: 0.95rem;
            font-weight: 400;
            color: white;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .video-item.active .video-item-title {
            color: var(--theme-color-light, #1db954);
            font-weight: 500;
        }

        .video-item-meta {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: #b3b3b3;
        }

        .video-item-channel {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .meta-dot {
            width: 3px;
            height: 3px;
            background: #b3b3b3;
            border-radius: 50%;
        }

        .loading {
            text-align: center;
            padding: 80px 20px;
            color: white;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #5a2a27;
            color: #f4b8b4;
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 100px 20px;
            color: white;
        }

        .empty-state .material-icons {
            font-size: 80px;
            opacity: 0.3;
            margin-bottom: 24px;
        }

        .empty-state h2 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .empty-state p {
            font-size: 0.95rem;
            color: #b3b3b3;
            font-weight: 300;
        }

        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #282828;
            border-radius: 10px;
            border: 3px solid #181818;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3e3e3e;
        }

        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .current-video {
                padding: 24px 20px;
            }

            .video-info {
                flex-direction: column;
            }

            .video-thumbnail {
                width: 100%;
                height: auto;
                max-width: 200px;
            }

            .video-title {
                font-size: 1.5rem;
            }

            .playlist-section {
                padding: 20px;
            }

            .video-item-thumbnail {
                width: 64px;
                height: 36px;
            }

            .search-box button {
                padding: 12px 20px;
                font-size: 0.8rem;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>YouTube Playlist Player</h1>
            <p>Playlistlerini keşfet ve müziğin tadını çıkar</p>
        </div>

        <div class="search-container">
            <div class="search-box">
                <div class="search-icon">
                    <span class="material-icons">search</span>
                </div>
                <input type="text" id="playlistInput" placeholder="Playlist URL veya ID girin...">
                <button onclick="loadPlaylist()">
                    Yükle
                </button>
            </div>
        </div>

        <div class="error" id="errorBox"></div>

        <div id="loadingBox" class="loading hidden">
            <div class="loading-spinner"></div>
            <p>Playlist yükleniyor...</p>
        </div>

        <div id="emptyState" class="empty-state">
            <span class="material-icons">library_music</span>
            <h2>Playlist bekleniyor</h2>
            <p>Yukarıya bir YouTube playlist linki yapıştırın</p>
        </div>

        <div class="player-container hidden" id="playerContainer">
            <div class="current-video" id="currentVideoSection">
                <div class="video-wrapper">
                    <iframe id="videoPlayer" frameborder="0" allowfullscreen
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                    </iframe>
                </div>
                <div class="video-info" id="currentVideoInfo"></div>
            </div>

            <div class="playlist-section">
                <div class="playlist-header">
                    <div class="playlist-title" id="playlistTitle">Playlist</div>
                    <div class="playlist-meta">
                        <div class="playlist-count" id="videoCount">0 şarkı</div>
                        <button class="share-button" onclick="sharePlaylist()" title="Playlist'i paylaş">
                            <span class="material-icons">share</span>
                            Paylaş
                        </button>
                    </div>
                </div>
                <div class="playlist-content" id="videoList"></div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyDPKFr63Y-zWgEkjdDKD893udw8lqbDFIw';
        let currentPlaylist = [];
        let currentVideoIndex = 0;
        let currentPlaylistId = '';

        function sharePlaylist() {
            if (!currentPlaylistId) return;
            
            const shareUrl = `${window.location.origin}/${currentPlaylistId}`;
            
            if (navigator.share) {
                navigator.share({
                    title: document.getElementById('playlistTitle').textContent,
                    text: `${currentPlaylist.length} şarkı içeren playlist`,
                    url: shareUrl
                }).catch(() => {
                    copyToClipboard(shareUrl);
                });
            } else {
                copyToClipboard(shareUrl);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.share-button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="material-icons">check</span>Kopyalandı!';
                btn.style.background = '#1db954';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);
            });
        }

        function extractPlaylistId(url) {
            const urlObj = new URL(url.includes('http') ? url : 'https://www.youtube.com/playlist?list=' + url);
            return urlObj.searchParams.get('list');
        }

        function showError(message) {
            const errorBox = document.getElementById('errorBox');
            errorBox.textContent = message;
            errorBox.classList.remove('hidden');
            errorBox.style.display = 'block';
            setTimeout(() => {
                errorBox.classList.add('hidden');
                errorBox.style.display = 'none';
            }, 5000);
        }

        function formatDuration(duration) {
            const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            const hours = (match[1] || '').replace('H', '');
            const minutes = (match[2] || '').replace('M', '');
            const seconds = (match[3] || '').replace('S', '');
            
            if (hours) {
                return `${hours}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}`;
            }
            return `${minutes || '0'}:${seconds.padStart(2, '0')}`;
        }

        function extractColors(imageUrl) {
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    try {
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;
                        let r = 0, g = 0, b = 0;
                        
                        for (let i = 0; i < data.length; i += 40) {
                            r += data[i];
                            g += data[i + 1];
                            b += data[i + 2];
                        }
                        
                        const pixelCount = data.length / 40;
                        r = Math.floor(r / pixelCount);
                        g = Math.floor(g / pixelCount);
                        b = Math.floor(b / pixelCount);
                        
                        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
                        const factor = brightness > 128 ? 0.6 : 1.2;
                        
                        r = Math.min(255, Math.floor(r * factor));
                        g = Math.min(255, Math.floor(g * factor));
                        b = Math.min(255, Math.floor(b * factor));
                        
                        resolve({ r, g, b });
                    } catch (e) {
                        resolve({ r: 30, g: 58, b: 95 });
                    }
                };
                img.onerror = function() {
                    resolve({ r: 30, g: 58, b: 95 });
                };
                img.src = imageUrl;
            });
        }

        function applyThemeColor(color) {
            const root = document.documentElement;
            root.style.setProperty('--theme-color', `rgb(${color.r}, ${color.g}, ${color.b})`);
            root.style.setProperty('--theme-color-dark', `rgb(${Math.floor(color.r * 0.6)}, ${Math.floor(color.g * 0.6)}, ${Math.floor(color.b * 0.6)})`);
            root.style.setProperty('--theme-color-light', `rgb(${Math.min(255, color.r + 60)}, ${Math.min(255, color.g + 60)}, ${Math.min(255, color.b + 60)})`);
            document.body.classList.add('loaded');
        }

        function updateMetaTags(playlistInfo, firstVideo) {
            // Dinamik meta tag güncellemeleri
            document.title = `${playlistInfo.title} - YouTube Playlist Player`;
            
            // Playlist URL'ini al
            const currentUrl = window.location.href;
            
            // Playlist kapak resmini al (YouTube'dan)
            const playlistThumbnail = playlistInfo.thumbnails?.high?.url || 
                                     playlistInfo.thumbnails?.medium?.url || 
                                     playlistInfo.thumbnails?.default?.url ||
                                     (firstVideo ? firstVideo.thumbnail : '');
            
            // Daha güzel açıklama formatı
            const description = `🎵 ${currentPlaylist.length} şarkı içeren playlist\n📝 ${playlistInfo.channelTitle || 'YouTube'} tarafından oluşturuldu`;
            
            // Meta description
            const metaDescription = document.querySelector('meta[name="description"]');
            if (metaDescription) {
                metaDescription.content = description;
            }
            
            // Open Graph Tags
            document.getElementById('ogTitle').setAttribute('content', playlistInfo.title);
            document.getElementById('ogDescription').setAttribute('content', description);
            document.getElementById('ogUrl').setAttribute('content', currentUrl);
            document.getElementById('ogImage').setAttribute('content', playlistThumbnail);
            
            // Twitter Card Tags
            document.getElementById('twitterTitle').setAttribute('content', playlistInfo.title);
            document.getElementById('twitterDescription').setAttribute('content', description);
            document.getElementById('twitterUrl').setAttribute('content', currentUrl);
            document.getElementById('twitterImage').setAttribute('content', playlistThumbnail);
        }

        async function loadPlaylist() {
            const input = document.getElementById('playlistInput').value.trim();
            if (!input) {
                showError('Lütfen bir playlist URL\'si girin!');
                return;
            }

            try {
                const playlistId = extractPlaylistId(input);
                if (!playlistId) {
                    showError('Geçersiz playlist URL\'si!');
                    return;
                }

                currentPlaylistId = playlistId;

                document.getElementById('loadingBox').classList.remove('hidden');
                document.getElementById('emptyState').classList.add('hidden');
                document.getElementById('playerContainer').classList.add('hidden');

                const playlistResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${playlistId}&key=${API_KEY}`
                );
                const playlistData = await playlistResponse.json();

                if (!playlistData.items || playlistData.items.length === 0) {
                    throw new Error('Playlist bulunamadı!');
                }

                const playlistInfo = playlistData.items[0].snippet;

                let allVideos = [];
                let nextPageToken = '';

                do {
                    const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${API_KEY}${nextPageToken ? '&pageToken=' + nextPageToken : ''}`;
                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.error) {
                        throw new Error(data.error.message);
                    }

                    allVideos = allVideos.concat(data.items);
                    nextPageToken = data.nextPageToken;
                } while (nextPageToken);

                const videoIds = allVideos.map(item => item.snippet.resourceId.videoId).join(',');
                const detailsResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=contentDetails,statistics&id=${videoIds}&key=${API_KEY}`
                );
                const detailsData = await detailsResponse.json();

                currentPlaylist = allVideos.filter(item => {
                    return item.snippet.title !== 'Private video' && 
                           item.snippet.title !== 'Deleted video' &&
                           item.snippet.thumbnails;
                }).map((item, index) => {
                    const details = detailsData.items ? detailsData.items.find(d => d.id === item.snippet.resourceId.videoId) : null;
                    return {
                        videoId: item.snippet.resourceId.videoId,
                        title: item.snippet.title,
                        thumbnail: item.snippet.thumbnails.medium ? item.snippet.thumbnails.medium.url : item.snippet.thumbnails.default.url,
                        channel: item.snippet.channelTitle,
                        duration: details ? formatDuration(details.contentDetails.duration) : 'N/A',
                        viewCount: details && details.statistics ? parseInt(details.statistics.viewCount).toLocaleString('tr-TR') : '0'
                    };
                });

                document.getElementById('playlistTitle').textContent = playlistInfo.title;
                document.getElementById('videoCount').textContent = `${currentPlaylist.length} şarkı`;
                
                // Meta tagları güncelle
                updateMetaTags(playlistInfo, currentPlaylist[0]);
                
                // URL hash'i güncelle
                window.location.hash = playlistId;
                
                displayPlaylist();
                playVideo(0);

                document.getElementById('loadingBox').classList.add('hidden');
                document.getElementById('playerContainer').classList.remove('hidden');

            } catch (error) {
                console.error('Hata:', error);
                showError('Playlist yüklenirken bir hata oluştu: ' + error.message);
                document.getElementById('loadingBox').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('hidden');
            }
        }

        function displayPlaylist() {
            const videoList = document.getElementById('videoList');
            videoList.innerHTML = currentPlaylist.map((video, index) => `
                <div class="video-item ${index === currentVideoIndex ? 'active' : ''}" onclick="playVideo(${index})">
                    <img src="${video.thumbnail}" alt="${video.title}" class="video-item-thumbnail">
                    <div class="video-item-info">
                        <div class="video-item-title">${video.title}</div>
                        <div class="video-item-meta">
                            <span class="video-item-channel">${video.channel}</span>
                            <span class="meta-dot"></span>
                            <span>${video.duration}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function playVideo(index) {
            currentVideoIndex = index;
            const video = currentPlaylist[index];
            
            document.getElementById('videoPlayer').src = 
                `https://www.youtube.com/embed/${video.videoId}?autoplay=1&rel=0`;
            
            document.getElementById('currentVideoInfo').innerHTML = `
                <img src="${video.thumbnail}" alt="${video.title}" class="video-thumbnail" id="mainThumbnail">
                <div class="video-details">
                    <div class="video-type">Video</div>
                    <div class="video-title">${video.title}</div>
                    <div class="video-channel">${video.channel}</div>
                    <div class="video-stats">
                        <span>${video.viewCount} görüntülenme</span>
                        <span class="stats-dot"></span>
                        <span>${video.duration}</span>
                    </div>
                </div>
            `;

            const colors = await extractColors(video.thumbnail);
            applyThemeColor(colors);

            displayPlaylist();
        }

        document.getElementById('playlistInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadPlaylist();
            }
        });

        window.addEventListener('hashchange', function() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                document.getElementById('playlistInput').value = hash;
                loadPlaylist();
            }
        });

        window.addEventListener('DOMContentLoaded', function() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                document.getElementById('playlistInput').value = hash;
                setTimeout(() => {
                    loadPlaylist();
                }, 500);
            }
        });
    </script>
</body>
                            </html>
